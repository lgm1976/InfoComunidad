/*** InfoComunidad - JavaScript Minificado v2.0 ***/
document.addEventListener('DOMContentLoaded',()=>{loadHeader(),loadFooter(),document.querySelector('.carousel-track')&&initCarousel(),document.getElementById('step-1')&&irAlPaso(1)});function getRelativePath(){const e=window.location.pathname,t=e.includes('InfoComunidad'),n=e.split('/').filter(e=>e.length>0);let a=t?n.length-1:n.length;return n[n.length-1].includes('.html')&&a--,a>0?'../'.repeat(a):''}function initScrollSpy(){}function loadHeader(){const e=document.querySelector('header');if(!e)return;const t=getRelativePath();fetch(`${t}assets/components/header.html`).then(e=>e.text()).then(n=>{let a=n.replace(/src="assets\//g,`src="${t}assets/`);a=a.replace(/href="([^"h][^"]+\.html)/g,`href="${t}$1`),e.innerHTML=a,initMobileMenu(),initScrollSpy()}).catch(e=>console.error("Error cargando el header:",e))}function loadFooter(){const e=document.querySelector('footer');if(!e)return;const t=getRelativePath();fetch(`${t}assets/components/footer.html`).then(e=>e.text()).then(t=>{e.innerHTML=t}).catch(e=>console.error("Error cargando el footer:",e))}function initMobileMenu(){const e=document.getElementById('menuToggle'),t=document.getElementById('navMenu');e&&t&&(e.addEventListener('click',()=>{t.classList.toggle('active'),e.classList.toggle('open')}),t.querySelectorAll('a').forEach(e=>{e.addEventListener('click',()=>{t.classList.remove('active'),e.classList.remove('open')})}))}function initCarousel(){document.querySelectorAll('.services-carousel').forEach(e=>{const t=e.querySelector('.carousel-track'),n=Array.from(t.querySelectorAll('.carousel-item')),a=e.querySelector('.carousel-btn.prev'),o=e.querySelector('.carousel-btn.next');if(!t||!n.length||!a||!o)return;const i=window.innerWidth<768?1:3;let r=i;const s=n.slice(-i).map(e=>e.cloneNode(!0)),l=n.slice(0,i).map(e=>e.cloneNode(!0));s.forEach(e=>t.prepend(e)),l.forEach(e=>t.append(e));const c=Array.from(t.children),d=()=>c[0].offsetWidth,u=(e=!0)=>{t.style.transition=e?'transform .4s ease':'none',t.style.transform=`translateX(-${r*d()}px)`};u(!1),o.addEventListener('click',()=>{r++,u(!0),r===c.length-i&&setTimeout(()=>{r=i,u(!1)},400)}),a.addEventListener('click',()=>{r--,u(!0),0===r&&setTimeout(()=>{r=c.length-2*i,u(!1)},400)}),window.addEventListener('resize',()=>u(!1))})}function initAutocomplete(){const e=document.getElementById('direccion');if(!e||'undefined'==typeof google)return;try{autocomplete=new google.maps.places.Autocomplete(e,{componentRestrictions:{country:'es'},fields:['address_components','geometry','formatted_address'],types:['address']}),autocomplete.addListener('place_changed',()=>{const e=autocomplete.getPlace();if(!e.geometry)return;direccionSeleccionada.direccionCompleta=e.formatted_address,e.address_components.forEach(e=>{const t=e.types[0];'route'===t&&(direccionSeleccionada.calle=e.long_name),'street_number'===t&&(direccionSeleccionada.numero=e.long_name),'locality'===t&&(direccionSeleccionada.ciudad=e.long_name),'administrative_area_level_2'===t&&(direccionSeleccionada.provincia=e.long_name),'postal_code'===t&&(direccionSeleccionada.codigoPostal=e.long_name)});const t=document.getElementById('map');if(t){if(t.style.display='block',!map){const o={zoom:17,center:e.geometry.location,disableDefaultUI:!0};map=new google.maps.Map(t,o),marker=new google.maps.Marker({map:map})}map.setCenter(e.geometry.location),marker.setPosition(e.geometry.location)}})}catch(e){console.warn('Autocompletado no disponible.')}}function gm_authFailure(){const e=document.getElementById('api-warning-msg');e&&(e.style.display='block');const t=document.getElementById('direccion');t&&(t.placeholder='Escriba la dirección manualmente...')}function irAlPaso(e){const t=document.querySelectorAll('.step'),n=document.getElementById('progress');t.forEach(e=>e.classList.remove('active'));const a=document.getElementById('step-'+e);a&&a.classList.add('active'),n&&(n.style.width=Math.round((e-1)/(t.length-1)*100)+'%',n.setAttribute('data-progress',Math.round((e-1)/(t.length-1)*100)+'%')),2===e&&map&&setTimeout(()=>{google.maps.event.trigger(map,'resize'),marker&&map.setCenter(marker.getPosition())},100),window.scrollTo(0,0)}function validarPaso1(){const e=document.getElementById('nombre').value,t=document.getElementById('apellidos').value,n=document.getElementById('telefono').value,a=document.getElementById('email').value;if(!e||!t||!n||!a)return void alert('Por favor, rellena todos los campos de contacto.');if(!document.getElementById('legal_consent').checked)return void alert('Debe aceptar las bases legales y la cesión de datos para continuar.');irAlPaso(2)}function calcularYMostrar(){const e=parseInt(document.getElementById('viviendas').value)||0,t=parseInt(document.getElementById('portales').value)||0,n=parseInt(document.getElementById('ascensores').value)||0,a=parseInt(document.getElementById('anoConstruccion').value)||2e3;let o=50;o+=3*e,o+=10*t,o+=12*n,a<1980?o+=25:a>=1980&&a<=1999&&(o+=15);const i=(e,t)=>{document.getElementById(e).checked&&(o+=t)};i('piscina',20),i('jardines',15),i('calefaccionCentral',20),i('placasSolares',10),i('garajesPCI',10),i('videoportero',8),i('limpieza',20),i('jardineria',15),i('seguridad',30),i('mantenimiento',25),'Comunidad sin administrador'===document.getElementById('motivo').value&&(o+=15);const r=5*Math.round(o/5);document.getElementById('precioMensual').innerText=r,irAlPaso(5)}function enviarAGoogleForms(){const e=document.getElementById('btnEnviar');e.innerText='Procesando...',e.disabled=!0;const t=direccionSeleccionada.direccionCompleta||document.getElementById('direccion').value,n=new FormData,a=e=>document.getElementById(e).value,o=e=>document.getElementById(e).checked?'Sí':'No';n.append('entry.952121618',a('email')),n.append('entry.1865292917',a('nombre')),n.append('entry.234721920',a('apellidos')),n.append('entry.1100157545',a('telefono')),n.append('entry.846456656',t),n.append('entry.106601160',direccionSeleccionada.calle||'N/A'),n.append('entry.795617294',direccionSeleccionada.numero||'N/A'),n.append('entry.53002704',direccionSeleccionada.ciudad||'N/A'),n.append('entry.1394003358',direccionSeleccionada.provincia||'N/A'),n.append('entry.773629670',direccionSeleccionada.codigoPostal||'N/A'),n.append('entry.147545752',a('viviendas')),n.append('entry.1924463597',a('portales')),n.append('entry.564268766',a('garajes')),n.append('entry.2078929423',a('locales')),n.append('entry.584238427',a('ascensores')),n.append('entry.1975390158',a('trasteros')),n.append('entry.1163192818',a('plantas')),n.append('entry.596687529',a('salasComunes')),n.append('entry.727114152',a('anoConstruccion')),n.append('entry.405354445',a('motivo')),n.append('entry.1521186204',o('piscina')),n.append('entry.1302898620',o('jardines')),n.append('entry.628796887',o('calefaccionCentral')),n.append('entry.98294061',o('placasSolares')),n.append('entry.1775785756',o('garajesPCI')),n.append('entry.652625492',o('videoportero')),n.append('entry.1005326668',o('limpieza')),n.append('entry.786662894',o('jardineria')),n.append('entry.1734050686',o('seguridad')),n.append('entry.1996415610',o('mantenimiento')),n.append('entry.2113593166',document.getElementById('precioMensual').innerText+' €/mes'),n.append('entry.507180921','Consentimiento Aceptado'),fetch('https://docs.google.com/forms/d/e/1FAIpQLSfgndZwqBTfmFR9rl0aU-wGmkgKA8e3UxIH4-rMI2G0Y63aVg/formResponse',{method:'POST',mode:'no-cors',body:n}).then(()=>irAlPaso(6)).catch(()=>{e.disabled=!1,e.innerText='Error, reintentar'})}function openModal(){document.getElementById('legalModal').style.display='flex'}function closeModal(){document.getElementById('legalModal').style.display='none'}function enviarContacto(){const e=document.getElementById('btnEnviarContacto'),t=document.getElementById('cNombre').value,n=document.getElementById('cMail').value,a=document.getElementById('cMensaje').value;if(!t||!n||!a)return void alert('Por favor, rellena todos los campos.');e.innerText='Enviando...',e.disabled=!0;const o=new FormData;o.append('entry.467394497',t),o.append('entry.2139652702',n),o.append('entry.1907644416',a),fetch('https://docs.google.com/forms/d/e/1FAIpQLSemH7TWACmrHYN0iZk0QCKMYsNO3UJGHjPyr6dlx2BJAnNNbQ/formResponse',{method:'POST',mode:'no-cors',body:o}).then(()=>{document.getElementById('contenedorContacto').innerHTML='<div class="card" style="max-width:500px;margin:48px auto 0;padding:40px;text-align:center;"><div style="font-size:40px;color:#28a745;margin-bottom:20px">✓</div><h3>¡Mensaje enviado!</h3><p>Gracias por contactar. Te responderemos muy pronto.</p></div>'}).catch(()=>{alert('Error al enviar.'),e.innerText='Enviar Mensaje',e.disabled=!1})}window.onclick=function(e){const t=document.getElementById('legalModal');e.target==t&&closeModal()};