document.addEventListener("DOMContentLoaded",()=>{const municipioSelect=document.getElementById("municipio-select");const searchBtn=document.getElementById("search-btn");const resultsContainer=document.getElementById("results-container");const noResults=document.getElementById("no-results");let subvenciones=[];let municipioChoices;municipioChoices=new Choices(municipioSelect,{searchEnabled:true,itemSelectText:"Seleccionar",placeholderValue:"Todos los municipios",removeItemButton:true,allowHTML:false,searchPlaceholderValue:"Escribe para filtrar..."});fetch("assets/data/subvenciones.json").then(response=>response.json()).then(data=>{subvenciones=data;populateMunicipios(data)}).catch(error=>{console.error("Error al cargar las subvenciones:",error);resultsContainer.innerHTML="<p>Error al cargar la información. Por favor, inténtalo más tarde.</p>"});function populateMunicipios(data){const municipios=[...new Set(data.map(item=>item.municipio))].filter(Boolean);municipios.sort();const choices=[{value:"",label:"Todos los municipios",selected:true}];municipios.forEach(municipio=>{if(municipio!=="Todos"){choices.push({value:municipio,label:municipio})}});municipioChoices.setChoices(choices,"value","label",true)}function displayResults(data){resultsContainer.innerHTML="";noResults.style.display=data.length===0?"block":"none";data.forEach(subvencion=>{const card=document.createElement("article");card.className="guia-card";const tagsHtml=subvencion.tags?`<div class="subvencion-tags">${subvencion.tags.map(tag=>`<span>${tag}</span>`).join("")}</div>`:"";card.innerHTML=`\n                <div class="guia-card-content">\n                    <div class="subvencion-header">\n                        <span class="subvencion-ambito">${subvencion.ambito||"General"}</span>\n                    </div>\n                    <h3>${subvencion.titulo}</h3>\n                    <p class="subvencion-municipio"><strong>Municipio:</strong> ${subvencion.municipio}</p>\n                    <p><strong>Organismo:</strong> ${subvencion.organo}</p>\n                    ${tagsHtml}\n                </div>\n                <div class="guia-card-footer">\n                    <p class="subvencion-fecha"><strong>Importe:</strong> ${subvencion.importe||"Consultar"}</p>\n                    <a href="${subvencion.url}" target="_blank" class="btn-leer">Ver Convocatoria Oficial →</a>\n                </div>\n            `;resultsContainer.appendChild(card)})}function handleSearch(){const municipioSeleccionado=municipioChoices.getValue(true);const filteredData=subvenciones.filter(subvencion=>{if(!municipioSeleccionado||municipioSeleccionado==="")return true;if(subvencion.municipio==="Todos"||subvencion.region==="Nacional")return true;return subvencion.municipio===municipioSeleccionado});displayResults(filteredData)}searchBtn.addEventListener("click",handleSearch)});