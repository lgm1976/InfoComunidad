document.addEventListener("DOMContentLoaded",()=>{const municipioSelect=document.getElementById("municipio-select");const searchBtn=document.getElementById("search-btn");const resultsContainer=document.getElementById("results-container");const noResults=document.getElementById("no-results");let subvenciones=[];fetch("assets/data/subvenciones.json").then(response=>response.json()).then(data=>{subvenciones=data;populateMunicipios(data);displayResults(data)}).catch(error=>{console.error("Error al cargar las subvenciones:",error);resultsContainer.innerHTML="<p>Error al cargar la información. Por favor, inténtalo más tarde.</p>"});function populateMunicipios(data){const municipios=[...new Set(data.map(item=>item.municipio))];municipios.sort();municipios.forEach(municipio=>{const option=document.createElement("option");option.value=municipio;option.textContent=municipio;municipioSelect.appendChild(option)})}function displayResults(data){resultsContainer.innerHTML="";noResults.style.display=data.length===0?"block":"none";data.forEach(subvencion=>{const card=document.createElement("article");card.className="guia-card";const fechaLimite=new Date(subvencion.fecha_limite);const opcionesFecha={year:"numeric",month:"long",day:"numeric"};const fechaFormateada=fechaLimite.toLocaleDateString("es-ES",opcionesFecha);card.innerHTML=`\n                <div class="guia-card-content">\n                    <div class="subvencion-header">\n                        <span class="subvencion-ambito">${subvencion.ambito}</span>\n                    </div>\n                    <h3>${subvencion.nombre}</h3>\n                    <p class="subvencion-municipio"><strong>Municipio:</strong> ${subvencion.municipio}</p>\n                    <p>${subvencion.descripcion}</p>\n                    <div class="subvencion-tags">\n                        ${subvencion.categorias.map(cat=>`<span>${cat}</span>`).join("")}\n                    </div>\n                </div>\n                <div class="guia-card-footer">\n                    <p class="subvencion-fecha"><strong>Fecha límite:</strong> ${fechaFormateada}</p>\n                    <a href="${subvencion.enlace}" target="_blank" class="btn-leer">Ver Ficha Completa →</a>\n                </div>\n            `;resultsContainer.appendChild(card)})}function handleSearch(){const municipioSeleccionado=municipioSelect.value;const filteredData=subvenciones.filter(subvencion=>!municipioSeleccionado||subvencion.municipio===municipioSeleccionado);displayResults(filteredData)}searchBtn.addEventListener("click",handleSearch)});